"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),instance=null,Utils=function(){function Utils(params){return _classCallCheck(this,Utils),this.langue=params.langue||"fr",this.staticRoot=params.static_root||"/static/",this.acceptMultilangue=params.acceptMultilangue||!1,this.staticFormatDate={fr:"DD/MM/YYYY",en:"YYYY/MM/DD"},this.verifyBoolean(params.debug,function(value){this.debug=value}),this.events={},this.rules={},this.customEvents={},this.map=null,this.markers=[],this.options_events={},this.acceptInfoWindow=params.acceptInfoWindow||!0,this.infosWindow={},instance||(instance=this),instance}return _createClass(Utils,[{key:"verifyBoolean",value:function(value,callback){var value_result=null;value_result=value!==!1,callback.call(this,value_result)}},{key:"log",value:function(msg,type){if(this.debug)switch(type){case"dir":console.dir(msg);break;case"error":throw new Error(msg);case"info":console.info(msg);break;case"table":console.table(msg);break;case"warning":console.warn(msg);break;default:console.log(msg)}}},{key:"is_string",value:function(value){return"string"==typeof value||value instanceof String?{valid:!0,message:null}:{valid:!1,message:"le champs est de type text"}}},{key:"is_number",value:function(value){return isNaN(value/1)?{valid:!1,message:"le champ est de type number"}:{valid:!0,message:null}}},{key:"is_email",value:function(email){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,test=re.test(email);return test?{valid:!0,message:null}:{valid:!1,message:"le champs est de type email adresse"}}},{key:"is_telephone",value:function(telephone){var re=/^((0|((\+|00)\d{2,3}))\d{9,20})$/,test=re.test(telephone);return test?{valid:!0,message:null}:{valid:!1,message:"le champs est de type téléphone numéro"}}},{key:"is_date",value:function(date){if("undefined"!=typeof moment){var date_moment=moment(date),test=date_moment.isValid();return test?{valid:!0,message:null}:{valid:!1,message:"le champs est de type date"}}this.log("Merci d'include le fichier moment.js sur votre page","error")}},{key:"is_Array",value:function(value){return Array.isArray(value)}},{key:"forEach",value:function(array,callback){if(this.is_array(array))for(var index=0;index<array.length;index++){var item=array[index];callback.call(this,item,index)}}},{key:"convertDate",value:function(value,format){return"undefined"!=typeof moment?moment(value,this.staticFormatDate[this.langue]).format(format):void this.log("Merci d'include le fichier moment.js sur votre page","error")}},{key:"addCarousel",value:function(parent,options){if("undefined"!=typeof $(parent).owlCarousel){var self=this,options_default={autoPlay:3e3,navigation:!0,slideSpeed:2e3,pagination:!1,singleItem:!0,stopOnHover:!0,navigationText:['<img src="'+self.staticRoot+'images/btn_right.png" />','<img src="'+self.staticRoot+'images/btn_left.png" />'],mouseDrag:!0,rewindNav:!0,items:1};"undefined"!=typeof options&&(options_default=options),$(parent).owlCarousel(options_default)}else this.log("Merci d'include le fichier owlCarousel.js sur votre page","error")}},{key:"generateID",value:function(l){return"undefined"==typeof l&&(l=36),Math.random().toString(l).substr(2,10)}},{key:"addDatePicker",value:function(selector,type,callback){if("undefined"!=typeof flatpickr){var options_defaults={};switch(type){case"normal":options_defaults={enableTime:!1,altInput:!0,time_24hr:!0,altFormat:"d/m/Y"};break;case"time":options_defaults={enableTime:!0,altInput:!0,time_24hr:!0,altFormat:"d/m/Y"}}$(selector).flatpickr(options_defaults)}else"undefined"!=typeof callback?callback.call(this,selector,type):this.log("Merci d'include le fichier flatpickr.js sur votre page, voici le lien : https://chmln.github.io/flatpickr/","error")}},{key:"runEvents",value:function(){if(null!==this.events)for(var event in this.events){var event_name=event.split(" ")[0],event_selecteur=event.substring(event_name.length,event.length),call_back=this.events[event];this.bindEvent(event_selecteur,event_name,call_back)}}},{key:"bindEvent",value:function(selector,event,callback){var self=this;$(selector).unbind(event),$(selector).bind(event,function(evt){if(evt.preventDefault(),null!==callback&&"undefined"!=typeof self[callback]){var reg=/^#|^./g,new_selector_key=selector.trim();reg.test(new_selector_key)&&(new_selector_key=new_selector_key.substring(1,new_selector_key.length));var data=self.options_events[new_selector_key];self[callback].call(this,evt,self,data)}else self.log("La fonction "+callback+" n'est pas défini dans l'objet Utils.","error")})}},{key:"addEvent",value:function(selector,event_type,callback,options){this.events[event_type+" "+selector]=callback;var reg=/^#|^./g,new_selector=selector.trim();reg.test(new_selector)&&(new_selector=new_selector.substring(1,new_selector.length)),this.options_events[new_selector]=options,this.runEvents()}},{key:"removeEvent",value:function(selector){for(var event in this.events){var event_name=event.split(" ")[0],event_selecteur=event.split(" ")[1];event_selecteur===selector&&($(selector).unbind(event_name),delete this.events[event_name+" "+event_selecteur])}}},{key:"TriggerEvent",value:function(selector,event){$(selector).trigger(event)}},{key:"addCustomEvent",value:function(name,callback,options){return this.customEvents[name]=callback,callback.bind(this,name,options)}},{key:"validate",value:function(form,success){this.addEvent(form+" input[type='submit']","click","validateForm",{parent:form,success:success})}},{key:"validateForm",value:function(evt,self,options){for(var nbr_input=$(options.parent).find("input[data-require='true']").length,test_passe=[],i=0;i<nbr_input;i++){var input=$(options.parent).find("input[name]").eq(i),required=$(input).data("require"),rule=$(input).data("rule"),value=$(input).val();if(required===!0&&"undefined"!=typeof required&&self.is_required(input,"Ce champ est obligatoire")&&"undefined"!=typeof rule){var rule_accept=self[rule](value);rule_accept.valid?(self.addErrorInput(input,!1,rule_accept.message),test_passe.push(value)):(self.addErrorInput(input,!0,rule_accept.message),test_passe.pop())}}if(test_passe.length===nbr_input){var serialize_form=$(options.parent).serializeArray();options.success.call(self,self.convertArrayToObject(serialize_form))}}},{key:"convertArrayToObject",value:function(data){if(Array.isArray(data)){for(var object={},a=0;a<data.length;a++)object[data[a].name]=data[a].value;return object}return null}},{key:"is_required",value:function(input,message){var value=$(input).val();return value.length>0&&null!==value&&"undefined"!=typeof value?!this.addErrorInput(input,!1):!this.addErrorInput(input,!0,message)}},{key:"addErrorInput",value:function(input,apply,message){return apply?$(input).addClass("error"):$(input).removeClass("error"),null!==this.inputErrorHTML&&"undefined"!=typeof this.inputErrorHTML&&this.inputErrorHTML.call(this,input,apply,message),apply}},{key:"inputErrorHTML",value:function(input,etat,message){$(input).parent().find("span.msg_error").remove(),etat&&$(input).parent().prepend('<span class="msg_error error">'+message+"</span>")}},{key:"createMaps",value:function(parent,coordonnees,options){var self=this;"undefined"==typeof options&&(options={zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP}),window.onload=function(){if("undefined"==typeof window.google)this.log('Inclure ce script sur votre page : <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"> </script>',"error");else{var cordonnees_lat_lng=new google.maps.LatLng(coordonnees.lat,coordonnees.lng),mapStyles=[{featureType:"administrative.country",stylers:[{visibility:"off"}]}],mapType=new google.maps.StyledMapType(mapStyles,{name:"Maroc"});options.center=cordonnees_lat_lng,self.maps=new google.maps.Map(document.getElementById(parent),options),self.maps.mapTypes.set("maroc",mapType),self.maps.setMapTypeId("maroc");var layer=new google.maps.FusionTablesLayer({query:{select:"geometry",from:"1S4aLkBE5u_WS0WMVSchhBgMLdAARuPEjyW4rs20",where:"col1 contains 'MAR'"},styles:[{polylineOptions:{strokeColor:"#333333",strokeWeight:2}}],suppressInfoWindows:!0});layer.setMap(self.maps);var nbr_markers=self.markers.length;if(nbr_markers>0)for(var i=0;i<nbr_markers;i++){var marker_data=self.markers[i];self.createMarker({coordonnees:self.convertObjetCords(marker_data.coordonnees),title:marker_data.title,icon:marker_data.icon,index:i,id:marker_data.id})}}}}},{key:"createMarker",value:function(objetMarker){var self=this,marker=new google.maps.Marker({position:objetMarker.coordonnees,map:self.maps,title:objetMarker.title,icon:objetMarker.icon});if(self.acceptInfoWindow){var infowindow=new google.maps.InfoWindow({content:self.infosWindow[objetMarker.id]});marker.addListener("click",function(){infowindow.open(self.maps,marker)})}return marker}},{key:"convertObjetCords",value:function(coordonnees){return new google.maps.LatLng(coordonnees.lat,coordonnees.lng)}},{key:"convertAdressToCords",value:function(address,callback){var self=this,geocoder=new google.maps.Geocoder;geocoder.geocode({address:address},function(results,status){"OK"===status&&"undefined"!=typeof callback&&callback.call(self,results[0].geometry.location.toJSON(),results,status)})}},{key:"addMarker",value:function(coordonnees,title,icon){"undefined"==typeof icon&&(icon=null);var id_marker=this.generateID();return this.markers.push({coordonnees:coordonnees,title:title,icon:icon,id:id_marker}),id_marker}},{key:"addInfoWindow",value:function(content,id){"undefined"!=typeof content&&(this.infosWindow[id]=content)}},{key:"renderTemplate",value:function(objetTemplate){var template=objetTemplate.template,templateURL=objetTemplate.templateURL,data=objetTemplate.data,parent=objetTemplate.parent,self=this;if("undefined"!=typeof Handlebars)if("undefined"==typeof templateURL||null===templateURL||""===templateURL){var source=$(template).html();this.render(source,data,parent)}else $.get(templateURL,function(template){self.render(template,data,parent)});else this.log("Merci d'ajouter le fichier Handlerbars.js sur votre page à partir de cette page : http://handlebarsjs.com/installation.html","error")}},{key:"render",value:function(template,data,parent){var template_compiled=Handlebars.compile(template),rendered=template_compiled(data);$(parent).html(rendered)}},{key:"getData",value:function(url,callback){var self=this;$.get(url,function(data){"undefined"!=typeof callback&&callback.call(self,data,this)})}},{key:"fetch",value:function(url,callback,error_callback){this.ajax(url,"GET",null,callback,error_callback)}},{key:"update",value:function(url,data,callback,error_callback){this.ajax(url,"PUT",data,callback,error_callback)}},{key:"post",value:function(url,data,callback,error_callback){this.ajax(url,"POST",data,callback,error_callback)}},{key:"ajax",value:function(url_ajax,type,data,callback,error_callback){var self=this,data_send="";"undefined"!=typeof data&&null!==data&&(data_send=JSON.stringify(data)),$.ajax({url:url_ajax,type:type,data:data_send,cache:!1,headers:{Accept:"application/json","Content-Type":"application/json"},contentType:!1,processData:!1,dataType:"json",success:function(data){"undefined"!=typeof callback&&null!==callback&&callback.call(self,data,this)},error:function(_error,xhr){"undefined"!=typeof error_callback&&null!==error_callback&&error_callback.call(self,xhr,_error,this)}})}},{key:"help",value:function(){this.log("la liste des methodes est en cours de création")}}]),Utils}();